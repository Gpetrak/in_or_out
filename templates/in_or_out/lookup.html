{% extends "in_or_out/in_or_out_base.html" %}
{% load i18n %}

{% block content %}

    <style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {height: 100%;
                  width: 100%;}
    
    /* Set gray background color and 100% height */
    .sidenav {
      padding: 15px; 
      background-color: #eee;
      height: 510px;
      overflow: scroll;
    }
    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 15px;
      }
    }
      #map {
        padding: 0px;
        width: auto;
        height: 510px;
      }

     </style>
    <div class="container-fluid">
      <div class="row content">
        <div class="col-sm-3 sidenav">
    <form role="form" action="/in_or_out/" method="post">{% csrf_token %}
        <div class="form-group">
          <label for="latitude">Γεωγραφικό Πλάτος:</label>
          <input id="id_latitude" name="latitude" required type="text" class="form-control"></input>
        </div>

        <div class="form-group">
            <label for="longitude">Γεωγραφικό Μήκος:</label>
            <input id="id_longitude" name="longitude" required type="text" class="form-control"></input>
        </div>

        <div class="form-group">
          <label for="x">ΕΓΣΑ 87 > Χ:</label>
          <input id="id_x" name="x" required type="text" class="form-control"></input>
        </div>

        <div class="form-group">
          <label for="y">ΕΓΣΑ 87 > Υ:</label>
          <input id="id_y" name="y" required type="text" class="form-control"></input>
        </div>

        
       <label>Επιλέξτε Επιφάνειες:</label>
       <div class="checkbox">
          <label><input type="checkbox" class="check" id="checkAll"> Επιλογή όλων</label>
        </div> 
       <div class="checkbox">
         <label>Natura 2000<input type="checkbox" class="check" name="natura" value""></label>
       </div>
       <div class="checkbox">
          <label>Οικισμοί Ν. Χανίων<input type="checkbox" class="check" name = "oikismoi" value""></label>
       </div>
       <div class="checkbox">
          <label>Αναδασμοί Ν.Ηρακλείου<input type="checkbox" class="check" name = "anadas2015" value""></label>
       </div>
       <div class="checkbox">
          <label>Αναδασμοί Ν.Χανίων<input type="checkbox" class="check" name = "anadasmoi" value""></label>
       </div>
       <div class="checkbox">
         <label>Αρχαιολογικοί Χώροι Ν.Χανίων<input type="checkbox" class="check" name = "arxaiologikoi_xwroi" value""></label>
       </div>
       <div class="checkbox">
         <label>Διανομή ΓΥΣ 5000 Ν.Χανίων<input type="checkbox" class="check" name = "dianomi_gys_5000" value""></label>
        </div>
        <div class="checkbox">
          <label>Ναυτικό Οχυρό Ν. Χανίων<input type="checkbox" class="check" name = "nautiko_oxyro" value""></label>
        </div>
        <div class="checkbox">
          <label>Πράξεις Χ/σμού Ν.Ηρακλείου<input type="checkbox" class="check" name = "praxeis_xar_2015"value""></label>
        </div>
        <div class="checkbox">
          <label>ΣΧΟΟΑΠ Κρουσώνα<input type="checkbox" class="check" name = "sxooap_krousona" value""></label>
        </div>
    <input class="btn btn-primary" type="submit" value="Εφαρμογή" />
    </form>
    </div>
    <div class="col-sm-7">
    <div id="map"></div>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" /> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
    <script>
     $(document).ready(function() {
     // script to enable the choice of "check all"
     $("#checkAll").click(function () {
         $(".check").prop('checked', $(this).prop('checked'));
     });
     var rememberLat = document.getElementById('id_latitude').value;
     var rememberLong = document.getElementById('id_longitude').value;
     if( !rememberLat || !rememberLong ) { rememberLat = 35.1333; rememberLong = 25.0213;}
     var tileLayer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
         attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> Contributors'
            });
     var map = new L.Map('map', {
             'center': [rememberLat, rememberLong],
             'zoom': 8,
             'layers': [tileLayer]
             });
     var marker = L.marker([rememberLat, rememberLong],{
         draggable: true
         }).addTo(map);
     marker.on('dragend', function (e) {
        updateLatLng(marker.getLatLng().lat, marker.getLatLng().lng);
         });
     map.on('click', function (e) {
        marker.setLatLng(e.latlng);
        updateLatLng(marker.getLatLng().lat, marker.getLatLng().lng);
        });
     function updateLatLng(lat,lng,reverse) {
            if(reverse) {
                marker.setLatLng([lat,lng]);
                map.panTo([lat,lng]);
             } else {
                  var egsaProj = "+proj=tmerc +lat_0=0 +lon_0=24 +k=0.9996 +x_0=500000 +y_0=0 +ellps=GRS80 +towgs84=-199.87,74.79,246.62,0,0,0,0 +units=m +no_defs";
                  var egsaCoords = proj4(egsaProj, [lng, lat]);
                  document.getElementById('id_latitude').value = marker.getLatLng().lat;
                  document.getElementById('id_longitude').value = marker.getLatLng().lng;
                  document.getElementById('id_x').value = egsaCoords[0];
                  document.getElementById('id_y').value = egsaCoords[1];
                  map.panTo([lat,lng]);
                  }       
         }
    });       
    </script>
  </div>
  <div class="col-sm-2 sidenav">
    <p>Επιλέξτε όσες από τις παρακάτω επιφάνειες επιθυμείτε και δείτε αν η τοποθεσία που σας ενδιαφέρει βρίσκεται εντός ή εκτός των περιοχών που επιλέξατε.</p>
    <p> Μετακινείστε το δείκτη που βρίσκεται στο χάρτη ώστε να εμφανιστούν οι αντίστοιχες συντεταγμένες στη φόρμα.</p>
    </div>

  </div>
</div>
{% endblock %}
